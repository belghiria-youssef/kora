<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kooralik - Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --bg-gradient: radial-gradient(circle at top, #1e293b, #0f172a);
            --card-bg: #1e293b;
            --border-color: #334155;
            --text-color: #e2e8f0;
            --highlight-color: #22c55e;
            --live-color: #ef4444;
            --secondary-bg: #111827;
        }
        [data-theme="light"] {
            --bg-color: #f1f5f9;
            --bg-gradient: radial-gradient(circle at top, #e2e8f0, #f1f5f9);
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-color: #1f2937;
            --highlight-color: #10b981;
            --live-color: #dc2626;
            --secondary-bg: #f9fafb;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            scroll-behavior: smooth;
        }
        .bg-slate-800, .bg-slate-800\/50 { background-color: var(--card-bg); }
        .bg-slate-900, .bg-slate-900\/50 { background-color: var(--secondary-bg); }
        .border-slate-700, .border-slate-700\/50 { border-color: var(--border-color); }
        .text-gray-200 { color: var(--text-color); }
        .text-green-400 { color: var(--highlight-color); }
        .text-red-400 { color: var(--live-color); }
        .filter-btn-active {
            background-color: var(--highlight-color) !important;
            color: white !important;
            box-shadow: 0 4px 14px 0 rgba(34, 197, 94, 0.39);
            border-color: var(--highlight-color) !important;
        }
        .sidebar-link-active {
            background-color: var(--secondary-bg);
            color: var(--highlight-color);
            font-weight: 700;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--secondary-bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
        /* Animations */
        @keyframes pulse-live {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .animate-pulse-live {
            animation: pulse-live 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader {
            border: 4px solid var(--border-color);
            border-left-color: var(--highlight-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .modal-backdrop, .sidebar-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content, #leagues-sidebar {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200" data-theme="dark">
    <header class="flex flex-col sm:flex-row items-center justify-between p-4 bg-slate-800">
        <div class="flex items-center mb-4 sm:mb-0">
            <img src="kooralogo.png" alt="Kooralik Logo" class="h-12 mr-4">
            <h1 class="text-2xl font-bold text-white">Kooralik</h1>
        </div>
        <div class="relative w-full max-w-sm sm:max-w-xs mb-4 sm:mb-0">
            <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙØ±ÙŠÙ‚ Ø£Ùˆ Ø¯ÙˆØ±ÙŠ..." class="bg-slate-700 text-white placeholder-gray-400 rounded-xl py-2 px-4 w-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-all duration-300">
            <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
            </svg>
        </div>
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-700 transition-colors duration-200">
            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-mode="dark"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
        </button>
    </header>
    <main class="container mx-auto px-2 sm:px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
            <div class="bg-slate-800 p-2 rounded-xl flex justify-center items-center gap-2 w-full max-w-lg shadow-md">
                <button id="btn-live" class="filter-btn flex-1 flex justify-center items-center gap-2 px-4 py-2 rounded-lg transition-all duration-300 text-red-400 border border-transparent hover:border-red-500/50 hover:bg-red-500/10">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 5.168A1 1 0 008 6v8a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4z" clip-rule="evenodd"></path></svg>
                    <span>Ù…Ø¨Ø§Ø´Ø±</span>
                </button>
                <input type="date" id="date-picker" class="flex-1 bg-transparent text-gray-300 rounded-lg p-2 text-center cursor-pointer focus:outline-none focus:ring-1 focus:ring-green-400 transition-colors">
            </div>
            <button id="toggle-sidebar-btn" class="md:hidden w-full max-w-lg bg-slate-700 text-white px-4 py-3 rounded-xl font-semibold flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path></svg>
                <span>ØªØµÙÙŠØ© Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª</span>
            </button>
        </div>

        <div id="live-matches-section" class="mb-8 hidden">
             <div id="live-matches-container" class="space-y-4">
                </div>
        </div>

        <div id="main-content-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <aside id="leagues-sidebar" class="md:col-span-1 md:block bg-slate-800/50 rounded-2xl p-4 h-fit fixed md:relative top-0 right-0 h-full w-64 md:w-auto z-50 transform translate-x-full md:translate-x-0 border border-slate-700/50">
                <div class="flex justify-between items-center mb-4 pb-3 border-b border-slate-700">
                    <h3 class="text-xl font-bold text-green-400">Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª</h3>
                    <button class="md:hidden text-2xl" onclick="toggleSidebar()">&times;</button>
                </div>
                <ul id="leagues-list" class="space-y-2"></ul>
            </aside>
            <div class="sidebar-overlay hidden fixed inset-0 bg-black/60 z-40" onclick="toggleSidebar()"></div>
            <div id="matches-container" class="md:col-span-2 lg:col-span-3 space-y-6"></div>
        </div>
    </main>
    <footer class="bg-slate-900 mt-10 py-8 border-t border-slate-700/50">
        <div class="container mx-auto px-4 text-center text-gray-400">
            <p>&copy; 2025 Kooralik. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        </div>
    </footer>
    <div id="match-details-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4 modal-backdrop opacity-0">
        <div class="modal-content bg-slate-800 rounded-2xl shadow-xl w-full max-w-md transform scale-95 border border-slate-700">
             <div class="flex justify-between items-center p-4 border-b border-slate-700">
                <div id="modal-league-info" class="flex items-center gap-3"></div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div class="p-6">
                <div class="flex justify-around items-center text-center">
                    <div class="flex-1 flex flex-col items-center gap-2"><img id="modal-home-logo" src="" alt="" class="w-20 h-20 object-contain"><h3 id="modal-home-name" class="font-bold text-lg"></h3></div>
                    <div class="w-28" id="modal-score-time"></div>
                    <div class="flex-1 flex flex-col items-center gap-2"><img id="modal-away-logo" src="" alt="" class="w-20 h-20 object-contain"><h3 id="modal-away-name" class="font-bold text-lg"></h3></div>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-700 text-center space-y-2 text-gray-300">
                    <p><strong>Ø§Ù„Ù…Ù„Ø¹Ø¨:</strong> <span id="modal-venue"></span></p>
                    <p><strong>Ø§Ù„Ø­ÙƒÙ…:</strong> <span id="modal-referee"></span></p>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-700 text-center space-y-2 text-gray-300">
                    <h4 class="font-bold text-lg">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</h4>
                    <div id="modal-stats" class="grid grid-cols-3 gap-4">
                        <div>
                            <p class="font-bold text-xl" id="stat-home-possession">0%</p>
                            <p class="text-sm">Ø§Ù„Ø§Ø³ØªØ­ÙˆØ§Ø°</p>
                        </div>
                        <div>
                            <p class="font-bold text-xl" id="stat-shots">0</p>
                            <p class="text-sm">Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª</p>
                        </div>
                        <div>
                            <p class="font-bold text-xl" id="stat-away-possession">0%</p>
                            <p class="text-sm">Ø§Ù„Ø§Ø³ØªØ­ÙˆØ§Ø°</p>
                        </div>
                    </div>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-700 text-center space-y-2 text-gray-300">
                    <h4 class="font-bold text-lg">Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</h4>
                    <ul id="modal-events" class="text-right space-y-2">
                        </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- START: API Configuration ---
        const API_KEY = '6cdb79349113fa71f35197659d70349c';
        const API_HOST = 'v3.football.api-sports.io';
        const API_BASE_URL = `https://${API_HOST}`;
        // --- END: API Configuration ---

        let allMatches = [];
        let currentLeagueFilter = null;
        let searchTimeout;

        const matchesContainer = document.getElementById('matches-container');
        const liveMatchesContainer = document.getElementById('live-matches-container');
        const liveMatchesSection = document.getElementById('live-matches-section');
        const leaguesList = document.getElementById('leagues-list');
        const allFilterButtons = document.querySelectorAll('.filter-btn');
        const btnLive = document.getElementById('btn-live');
        const modal = document.getElementById('match-details-modal');
        const sidebar = document.getElementById('leagues-sidebar');
        const sidebarOverlay = document.querySelector('.sidebar-overlay');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
        const mainContentGrid = document.getElementById('main-content-grid');
        const searchInput = document.getElementById('search-input');
        const datePicker = document.getElementById('date-picker');
        const themeToggle = document.getElementById('theme-toggle');

        const getFormattedDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const fetchMatches = async (dateString) => {
            currentLeagueFilter = null;
            searchInput.value = '';
            mainContentGrid.classList.remove('hidden');
            liveMatchesSection.classList.add('hidden');
            matchesContainer.innerHTML = `<div class="flex flex-col justify-center items-center text-center text-gray-400 bg-slate-800/50 p-8 rounded-2xl"><div class="loader mb-4"></div><p class="text-xl">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª...</p></div>`;
            leaguesList.innerHTML = '';
            const url = `${API_BASE_URL}/fixtures?date=${dateString}`;

            try {
                const response = await fetch(url, { method: 'GET', headers: { 'x-rapidapi-host': API_HOST, 'x-rapidapi-key': API_KEY }});
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                if (data.errors && Object.keys(data.errors).length > 0) throw new Error(`API Error: ${JSON.stringify(data.errors)}`);

                allMatches = data.response.map(match => ({
                    fixtureId: match.fixture.id,
                    league: { id: match.league.id, name: match.league.name, logo: match.league.logo },
                    status: match.fixture.status.short,
                    time: match.fixture.status.elapsed,
                    fixtureDate: new Date(match.fixture.date),
                    fixtureTime: new Date(match.fixture.date).toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: true }),
                    homeTeam: { id: match.teams.home.id, name: match.teams.home.name, logo: match.teams.home.logo },
                    awayTeam: { id: match.teams.away.id, name: match.teams.away.name, logo: match.teams.away.logo },
                    score: { home: match.goals.home, away: match.goals.away },
                    venue: match.fixture.venue.name,
                    referee: match.fixture.referee,
                }));

                renderLeaguesSidebar(allMatches);
                renderMatches(allMatches);
            } catch (error) {
                console.error("Error fetching matches:", error);
                matchesContainer.innerHTML = `<div class="text-center text-red-400 bg-slate-800/50 p-8 rounded-2xl"><p class="text-xl font-semibold">Ø­Ø¯Ø« Ø®Ø·Ø£!</p><p>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª.</p></div>`;
            }
        };

        const fetchMatchDetails = async (fixtureId) => {
            const url = `${API_BASE_URL}/fixtures/statistics?fixture=${fixtureId}`;
            try {
                const response = await fetch(url, { method: 'GET', headers: { 'x-rapidapi-host': API_HOST, 'x-rapidapi-key': API_KEY }});
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error("Error fetching match statistics:", error);
                return null;
            }
        };

        const fetchMatchEvents = async (fixtureId) => {
            const url = `${API_BASE_URL}/fixtures/events?fixture=${fixtureId}`;
            try {
                const response = await fetch(url, { method: 'GET', headers: { 'x-rapidapi-host': API_HOST, 'x-rapidapi-key': API_KEY }});
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error("Error fetching match events:", error);
                return null;
            }
        };

        const showGoalNotification = (match) => {
            if (Notification.permission === 'granted') {
                const title = `Ù‡Ø¯Ù ÙÙŠ Ù…Ø¨Ø§Ø±Ø§Ø© ${match.homeTeam.name} - ${match.awayTeam.name}`;
                const body = `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¢Ù†: ${match.score.home} - ${match.score.away}`;
                new Notification(title, { body: body });
            }
        };

        const renderLiveMatches = (matchesData) => {
            if (matchesData.length > 0) {
                liveMatchesSection.classList.remove('hidden');
                liveMatchesContainer.innerHTML = matchesData.map(match => {
                     const matchIndex = allMatches.findIndex(m => m.fixtureId === match.fixtureId);
                     return `
                        <div class="bg-slate-800/50 rounded-xl border border-slate-700/50 transition-all duration-300 fade-in overflow-hidden">
                            <div class="p-4 cursor-pointer hover:bg-slate-800" onclick="showMatchDetails(${matchIndex})">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3 flex-1 justify-end">
                                        <span class="text-base font-semibold text-right">${match.homeTeam.name}</span>
                                        <img src="${match.homeTeam.logo}" class="w-8 h-8 object-contain">
                                    </div>
                                    <div class="mx-4 text-center">
                                        <div class="text-2xl font-bold text-green-400">${match.score.home} - ${match.score.away}</div>
                                        <div class="text-sm text-red-500 animate-pulse-live">${match.time}'</div>
                                    </div>
                                    <div class="flex items-center gap-3 flex-1 justify-start">
                                        <img src="${match.awayTeam.logo}" class="w-8 h-8 object-contain">
                                        <span class="text-base font-semibold text-left">${match.awayTeam.name}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-slate-900/50 p-2">
                                <a href="http://www.koraa-live.net" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-2 w-full text-sm font-semibold text-green-400 hover:bg-green-500/10 py-2 rounded-lg transition-colors">
                                     <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path></svg>
                                     <span>Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</span>
                                </a>
                            </div>
                        </div>
                     `;
                }).join('');
            } else {
                liveMatchesSection.classList.remove('hidden');
                liveMatchesContainer.innerHTML = `<div class="text-center text-gray-400 bg-slate-800/50 p-8 rounded-2xl border border-slate-700/50"><p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</p></div>`;
            }
        };

        const renderLeaguesSidebar = (matchesData) => {
             const priorityLeagues = ['UEFA Champions League', 'UEFA Europa League', 'Premier League', 'La Liga', 'Serie A', 'Bundesliga', 'Ligue 1', 'Saudi Professional League', 'CAF Champions League', 'Copa Libertadores', 'AFC Champions League'];
             const uniqueLeagues = [...new Map(matchesData.map(m => [m.league.id, m.league])).values()]
                .filter(l => priorityLeagues.includes(l.name))
                .sort((a,b) => priorityLeagues.indexOf(a.name) - priorityLeagues.indexOf(b.name));
            leaguesList.innerHTML = `<li><a href="#" class="sidebar-link flex items-center gap-3 w-full text-right px-3 py-2 rounded-lg transition-colors duration-200 sidebar-link-active" onclick="handleLeagueClick(event, null)">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                <span>ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª</span>
            </a></li>`;
            uniqueLeagues.forEach(league => {
                leaguesList.innerHTML += `<li><a href="#" class="sidebar-link flex items-center gap-3 w-full text-right px-3 py-2 rounded-lg transition-colors duration-200 hover:bg-slate-700/50" onclick="handleLeagueClick(event, ${league.id})">
                    <img src="${league.logo}" class="w-5 h-5 object-contain rounded-full">
                    <span>${league.name}</span>
                </a></li>`;
            });
        };

        const groupMatchesByLeague = (matches) => {
            return matches.reduce((acc, match) => {
                const leagueId = match.league.id;
                if (!acc[leagueId]) { acc[leagueId] = { ...match.league, matches: [] }; }
                acc[leagueId].matches.push(match);
                return acc;
            }, {});
        };

        const renderMatches = (matchesData) => {
            const filteredData = currentLeagueFilter ? matchesData.filter(m => m.league.id === currentLeagueFilter) : matchesData;
            matchesContainer.innerHTML = '';
            if (!filteredData || filteredData.length === 0) {
                matchesContainer.innerHTML = `<div class="text-center text-gray-400 bg-slate-800/50 p-8 rounded-2xl border border-slate-700/50"><p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±.</p></div>`;
                return;
            }
            const groupedLeagues = groupMatchesByLeague(filteredData);
            const priorityLeagues = ['UEFA Champions League', 'UEFA Europa League', 'Premier League', 'La Liga', 'Serie A', 'Bundesliga', 'Ligue 1', 'Saudi Professional League', 'CAF Champions League', 'Copa Libertadores', 'AFC Champions League'];
            const sortedLeagues = Object.values(groupedLeagues).sort((a, b) => {
                const aPriority = priorityLeagues.indexOf(a.name);
                const bPriority = priorityLeagues.indexOf(b.name);
                if (aPriority !== -1 && bPriority !== -1) return aPriority - bPriority;
                if (aPriority !== -1) return -1;
                if (bPriority !== -1) return 1;
                return a.name.localeCompare(b.name);
            });
            for (const league of sortedLeagues) {
                const leagueHeader = `<div class="flex items-center gap-3 px-4 py-2 bg-slate-800/50 rounded-t-2xl border-b-2 border-slate-700"><img src="${league.logo}" alt="${league.name}" class="w-8 h-8 object-contain" onerror="this.onerror=null;this.src='https://placehold.co/64x64/333/fff?text=L';"><h2 class="text-xl font-bold text-gray-200">${league.name}</h2></div>`;
                const matchesHTML = league.matches.map(match => {
                    const matchIndex = allMatches.findIndex(m => m.fixtureId === match.fixtureId);
                    let scoreOrTime, liveIndicator = '', statusIndicator = '';
                    switch (match.status) {
                        case 'NS': scoreOrTime = `<div class="text-2xl font-bold text-gray-300 tracking-wider">${match.fixtureTime}</div>`; break;
                        case 'FT': case 'AET': case 'PEN':
                            scoreOrTime = `<div class="text-3xl font-bold text-white">${match.score.home} - ${match.score.away}</div>`;
                            statusIndicator = `<div class="absolute top-3 left-3 text-gray-400 font-semibold">${match.status}</div>`; break;
                        case '1H': case 'HT': case '2H': case 'ET':
                            scoreOrTime = `<div class="text-3xl font-bold text-green-400">${match.score.home} - ${match.score.away}</div>`;
                            liveIndicator = `<div class="absolute top-3 left-3 flex items-center gap-2 text-red-500 animate-pulse-live"><span class="font-semibold">${match.time}'</span></div>`; break;
                        default:
                            scoreOrTime = `<div class="text-lg font-bold text-yellow-500">Ù…Ø¤Ø¬Ù„Ø©</div>`;
                            statusIndicator = `<div class="absolute top-3 left-3 text-yellow-400 font-semibold">${match.status}</div>`; break;
                    }
                    return `<div class="relative bg-slate-800/50 p-4 border-b border-slate-700/50 last:border-b-0 last:rounded-b-2xl cursor-pointer hover:bg-slate-800 transition-colors duration-200 fade-in" onclick="showMatchDetails(${matchIndex})">
                            ${liveIndicator} ${statusIndicator}
                            <div class="flex justify-around items-center text-center">
                                <div class="flex-1 flex flex-col items-center gap-2"><img src="${match.homeTeam.logo}" alt="${match.homeTeam.name}" class="w-16 h-16 object-contain" onerror="this.onerror=null;this.src='https://placehold.co/100x100/333/fff?text=T1';"><h3 class="font-semibold text-md md:text-lg">${match.homeTeam.name}</h3></div>
                                <div class="w-28">${scoreOrTime}</div>
                                <div class="flex-1 flex flex-col items-center gap-2"><img src="${match.awayTeam.logo}" alt="${match.awayTeam.name}" class="w-16 h-16 object-contain" onerror="this.onerror=null;this.src='https://placehold.co/100x100/333/fff?text=T2';"><h3 class="font-semibold text-md md:text-lg">${match.awayTeam.name}</h3></div>
                            </div>
                        </div>`;
                }).join('');
                const leagueContainer = document.createElement('div');
                leagueContainer.className = 'bg-slate-800/50 rounded-2xl shadow-lg overflow-hidden border border-slate-700/50 fade-in';
                leagueContainer.innerHTML = leagueHeader + matchesHTML;
                matchesContainer.appendChild(leagueContainer);
            }
        };

        const showMatchDetails = async (index) => {
            const match = allMatches[index];
            if (!match) return;

            document.getElementById('modal-league-info').innerHTML = `<img src="${match.league.logo}" class="w-8 h-8 object-contain"><span class="font-semibold">${match.league.name}</span>`;
            document.getElementById('modal-home-logo').src = match.homeTeam.logo;
            document.getElementById('modal-home-name').textContent = match.homeTeam.name;
            document.getElementById('modal-away-logo').src = match.awayTeam.logo;
            document.getElementById('modal-away-name').textContent = match.awayTeam.name;
            document.getElementById('modal-venue').textContent = match.venue || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('modal-referee').textContent = match.referee || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            let scoreOrTimeHTML = '';
            if (match.status === 'NS') scoreOrTimeHTML = `<div class="text-3xl font-bold text-gray-300 tracking-wider">${match.fixtureTime}</div>`;
            else if (['FT', 'AET', 'PEN'].includes(match.status)) scoreOrTimeHTML = `<div class="text-4xl font-bold text-white">${match.score.home} - ${match.score.away}</div><div class="text-sm text-gray-400 mt-1">${match.status}</div>`;
            else if (['1H', 'HT', '2H', 'ET'].includes(match.status)) scoreOrTimeHTML = `<div class="text-4xl font-bold text-green-400">${match.score.home} - ${match.score.away}</div><div class="text-sm text-red-500 mt-1">${match.time}'</div>`;
            else scoreOrTimeHTML = `<div class="text-xl font-bold text-yellow-500">Ù…Ø¤Ø¬Ù„Ø©</div>`;
            document.getElementById('modal-score-time').innerHTML = scoreOrTimeHTML;

            // Fetch and display match statistics
            const statsData = await fetchMatchDetails(match.fixtureId);
            const homeStats = statsData.find(s => s.team.id === match.homeTeam.id)?.statistics || [];
            const awayStats = statsData.find(s => s.team.id === match.awayTeam.id)?.statistics || [];
            const homePossession = homeStats.find(s => s.type === 'Ball Possession')?.value || '0%';
            const awayPossession = awayStats.find(s => s.type === 'Ball Possession')?.value || '0%';
            const homeShots = homeStats.find(s => s.type === 'Total Shots')?.value || '0';
            const awayShots = awayStats.find(s => s.type === 'Total Shots')?.value || '0';

            document.getElementById('stat-home-possession').textContent = homePossession;
            document.getElementById('stat-shots').textContent = `${homeShots} - ${awayShots}`;
            document.getElementById('stat-away-possession').textContent = awayPossession;

            // Fetch and display match events
            const eventsData = await fetchMatchEvents(match.fixtureId);
            const eventsList = document.getElementById('modal-events');
            eventsList.innerHTML = '';
            if (eventsData && eventsData.length > 0) {
                eventsData.sort((a,b) => a.time.elapsed - b.time.elapsed);
                eventsData.forEach(event => {
                    let icon = '';
                    if (event.type === 'Goal') icon = 'âš½';
                    else if (event.type === 'Card') icon = 'ğŸŸ¨';
                    else if (event.type === 'subst') icon = 'ğŸ”„';
                    const eventText = `${event.time.elapsed}' - ${event.detail}: ${event.player.name} (${event.team.name}) ${icon}`;
                    const li = document.createElement('li');
                    li.textContent = eventText;
                    eventsList.appendChild(li);
                });
            } else {
                eventsList.innerHTML = '<li class="text-center text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ù…ØªØ§Ø­Ø©.</li>';
            }

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        };

        const closeModal = () => {
            modal.classList.add('opacity-0');
            modal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };

        const toggleSidebar = () => {
            sidebar.classList.toggle('translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        };

        const handleSearch = () => {
            const searchTerm = searchInput.value.trim().toLowerCase();
            let filteredMatches = [];
            if (searchTerm === '') {
                filteredMatches = allMatches;
            } else {
                filteredMatches = allMatches.filter(match =>
                    match.homeTeam.name.toLowerCase().includes(searchTerm) ||
                    match.awayTeam.name.toLowerCase().includes(searchTerm) ||
                    match.league.name.toLowerCase().includes(searchTerm)
                );
            }
            renderMatches(filteredMatches);
        };

        const toggleTheme = () => {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            const icon = themeToggle.querySelector('svg');
            if (newTheme === 'dark') {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>';
            }
        };

        const requestNotificationPermission = () => {
            if (!("Notification" in window)) {
                console.log("This browser does not support desktop notification");
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission();
            }
        };

        datePicker.addEventListener('change', (e) => {
            const selectedDate = e.target.value;
            allFilterButtons.forEach(btn => btn.classList.remove('filter-btn-active'));
            fetchMatches(selectedDate);
        });
        btnLive.addEventListener('click', handleLiveClick);
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        toggleSidebarBtn.addEventListener('click', toggleSidebar);
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(handleSearch, 300);
        });
        themeToggle.addEventListener('click', toggleTheme);

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const formattedToday = getFormattedDate(today);
            datePicker.value = formattedToday;
            fetchMatches(formattedToday);
            requestNotificationPermission();
        });
    </script>
</body>
</html>
